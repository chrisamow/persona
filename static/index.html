<!doctype html>

<html lang="en">
<head>
  <meta charset="utf-8">

  <title>Persona</title>

  <link rel="stylesheet" href="static/styles.css?v=1.0">
  <!-- Latest compiled and minified CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body>
  <div id="app" class="container">
    <div>
      <span class="app-status">{{appstatus}}</span>
      <div class="col-xs-12" style="height:50px;"></div>
      <form class="form-horizontal">
        <div class="row">
          <div class="form-group">
            <div class="col-xs-8"><input type="text" class="form-control" placeholder="search for..." v-model="searchterm"></div>
            <div class="col-xs-2">
              <button type="button" class="btn btn-primary form-control" v-on:click="search">Search</button>
            </div>
            <div class="col-xs-2">
              <select v-model="selected" class="form-control" v-on:click="jumpto">
                  <option v-for="letter in letters" v-bind:value="letter">
                    {{ letter }}
                  </option>
              </select>
            </div>
          </div>
        </div>
      </form>
      <div class="col-xs-12" style="height:50px;"></div>
      <table id="mainlist" class="table table-striped table-hover">
        <thead class="thead-inverse">
          <tr v-if="persons.length>0">
            <th>Last name</th>
            <th>First name</th>
            <th>Date of birth</th>
            <th>Zipcode</th>
          </tr>
        </thead>
        <tbody>
          <tr v-for="person in persons" v-bind:id="person.id" v-on:dblclick="editrow($event)">
            <td>{{ person.lastname }}</td>
            <td>{{ person.firstname }}</td>
            <td>{{ person.dateofbirth }}</td>
            <td>{{ person.zipcode }}</td>
          </tr>
        <tbody>
      </table>
    </div>
  </div>
  <script src="https://unpkg.com/vue@2.2.3"></script>
  <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.2/lodash.min.js"></script> -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.15.3/axios.min.js"></script>
  <script>
    var app = new Vue({
      el: '#app',
      data: {
        api: '',
        zipcode: '',
        city: '',
        appstatus: 'ok',
        searchterm: '',
        selected: '',
        letters: ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'],
        persons: []
      },
      watch: {
        zipcode: function() {
          this.city = ''
          if(this.zipcode.length == 5) {
            this.lookupzip()
          }
        }
      },
      created: function () {
        api = 'http://' + window.location.host + '/api/'
        //window.addEventListener('scroll', this.handleScroll)
        this.fetchpersons()
      },
      destroyed: function () {
        //window.removeEventListener('scroll', this.handleScroll)
      },
      methods: {
        jumpto: function() {
          window.alert("jumping to " + this.selected)
        },
        search: function() {
          //window.alert("searching for: " + this.searchterm)
          this.fetchpersons()
        },
        editrow: function(e) {
          window.alert("edit row")
          //e.currentTarget.contentEditable = true  //not going to work
        },
        handleScroll: function () {
          this.scrollPos = document.body.scrollHeight - window.innerHeight - document.body.scrollTop;   
          if (document.body.scrollHeight - window.innerHeight - document.body.scrollTop == 0) {
            // load more data here...
          }
        },
        fetchpersons: function() {
          var a = this; //app
          u = api + 'persons'
          a.appstatus = "REST:" + u
          axios.get(u)
            .then(function (response) {
              console.log(response)
              a.persons = response.data
              if (a.persons.length > 0) {
              }
              //response.data.error  //error code here tbd
            })
            .catch(function (error) {
              a.searchterm = "Invalid Data"
            })
        }, 
      }
    })
  </script>
</body>
</html>

